<div *ngIf="!isParieurLoggedIn()">
  <app-connexion-parieur></app-connexion-parieur>
</div>

<div *ngIf="isParieurLoggedIn()">
  <div class="container">
    <mat-card>
      <button
        class="center"
        type="button"
        mat-raised-button
        color="warn"
        (click)="logout()"
      >
        <mat-icon>logout</mat-icon>
        Parier avec un autre profil</button
      ><br />

      <h2 class="lobster center">{{ getNomParieur() }}</h2>

      <h3 class="center">
        <b>Votre score : </b
        ><span id="score"
          >{{ getPoints() }} point{{ getPoints() > 1 ? "s" : "" }}</span
        >
      </h3>
    </mat-card>

    <mat-card *ngIf="tableauxPariables.length === 0 && tableauxGet">
      <h3 class="lobster center">
        Il n'y a pas de tableaux ouverts aux paris pour le moment
      </h3>
    </mat-card>
  </div>

  <mat-tab-group
    *ngIf="tableauxPariables.length > 0"
    mat-align-tabs="center"
    color="accent"
    [dynamicHeight]="true"
    selectedIndex="0"
  >
    <mat-tab *ngFor="let tableauPariable of tableauxPariables">
      <ng-template mat-tab-label class="mat-tab-label">{{
        tableauPariable.tableau.nom | titlecase
      }}</ng-template>

      <p *ngIf="tableauPariable.tableau.is_launched > 2">
        Paris cloturés pour ce tableau
      </p>

      <div class="container">
        <mat-card>
          <div *ngIf="tableauPariable.tableau.is_launched > 1">
            <p
              *ngIf="infosParisJoueur.id_prono_vainqueur"
              class="center"
              style="margin-bottom: 0px"
            >
              Vous avez parié sur
              <b>{{ infosParisJoueur.id_prono_vainqueur.nom }}</b> comme grand
              vainqueur
            </p>
            <p
              *ngIf="!infosParisJoueur.id_prono_vainqueur"
              class="center"
              style="margin-bottom: 0px"
            >
              Vous n'avez pas parié sur le grand vainqueur
            </p>
          </div>
          <div
            fxLayout="column"
            *ngIf="tableauPariable.tableau.is_launched === 1"
            class="center"
          >
            <div fxFlex="100%">
              <p>
                <b
                  >Parier sur le grand vainqueur du tableau
                  {{ tableauPariable.tableau.nom | titlecase }} :</b
                >
              </p>
            </div>
            <div fxFlex="25%" fxFlex.lt-md="100%">
              <mat-form-field appearance="fill">
                <mat-label>Vainqueur</mat-label>
                <mat-select
                  (selectionChange)="updateVainqueur($event)"
                  [ngModel]="getNgModelVainqueur()"
                >
                  <mat-option
                    *ngFor="let participant of tableauPariable.participants"
                    [value]="participant._id"
                  >
                    {{ participant.nom }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </mat-card>
      </div>

      <mat-tab-group
        mat-align-tabs="center"
        color="accent"
        dynamicHeight="200%"
        selectedIndex="0"
        *ngIf="
          tableauPariable.tableau._id &&
          tableauPariable.tableau.is_launched === 2
        "
      >
        <mat-tab>
          <ng-template mat-tab-label class="mat-tab-label">
            Phases finales
          </ng-template>

          <app-bracket
            *ngIf="infosParisJoueur !== null"
            [infosParisJoueur]="infosParisJoueur"
            [isPari]="true"
            [phase]="'finale'"
            [tableau]="tableauPariable.tableau"
          ></app-bracket>
        </mat-tab>

        <mat-tab
          *ngIf="
            tableauPariable.tableau.consolante &&
            tableauPariable.tableau.consolantePariable
          "
        >
          <ng-template mat-tab-label class="mat-tab-label"
            >Consolante</ng-template
          >

          <app-bracket
            *ngIf="infosParisJoueur !== null"
            [infosParisJoueur]="infosParisJoueur"
            [isPari]="true"
            [phase]="'consolante'"
            [tableau]="tableauPariable.tableau"
          ></app-bracket>
        </mat-tab>
      </mat-tab-group>
    </mat-tab>
  </mat-tab-group>
</div>
